<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HHYC Volunteer Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .auth-screen {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
            max-width: 500px;
            margin: 0 auto;
        }

        .auth-screen h2 {
            margin-bottom: 2rem;
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            background: rgba(255,255,255,0.9);
            color: #333;
        }

        .btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.5);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .volunteer-interface {
            display: none;
        }

        .section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
        }

        .section h3 {
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .error-message {
            color: #ff6b6b;
            text-align: center;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255,107,107,0.1);
            border-radius: 8px;
            display: none;
        }

        .success-message {
            color: #51cf66;
            text-align: center;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(81,207,102,0.1);
            border-radius: 8px;
            display: none;
        }

        .event-card {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .task-card {
            background: rgba(255,255,255,0.08);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid rgba(255,255,255,0.5);
        }

        .working-with {
            background: rgba(81,207,102,0.1);
            border-radius: 6px;
            padding: 0.5rem;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }

        .btn-signup {
            background: rgba(81,207,102,0.3);
            border: 2px solid rgba(81,207,102,0.6);
        }

        .btn-signup:hover {
            background: rgba(81,207,102,0.4);
        }

        .btn-signed-up {
            background: rgba(255,193,7,0.3);
            border: 2px solid rgba(255,193,7,0.6);
            cursor: default;
        }

        .event-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 1rem;
            float: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ Hidden Harbor Yacht Club</h1>
            <p>Volunteer Portal - Join Our Community Events</p>
        </div>

        <!-- Authentication Screen -->
        <div class="auth-screen" id="authScreen">
            <h2>üîê Volunteer Access</h2>
            <p>Please enter the volunteer gate code to continue</p>

            <div class="form-group">
                <label for="gateCode">Gate Code:</label>
                <input type="password" id="gateCode" placeholder="Enter gate code">
            </div>

            <button class="btn" onclick="authenticateVolunteer()">Access Volunteer Portal</button>

            <div class="error-message" id="authError">
                Incorrect gate code. Please try again.
            </div>
        </div>

        <!-- Volunteer Interface -->
        <div class="volunteer-interface" id="volunteerInterface">
            <!-- Welcome Section -->
            <div class="section">
                <h3>üåü Welcome, Volunteer!</h3>
                <p>Choose from the available tasks below and sign up to help our community. You'll see who else is volunteering so you can coordinate with fellow members.</p>
            </div>

            <!-- Available Events and Tasks -->
            <div class="section">
                <h3>üìÖ Available Volunteer Opportunities</h3>
                <div id="eventTasksList">
                    <p>Loading volunteer opportunities...</p>
                </div>
            </div>

            <!-- My Current Signups -->
            <div class="section">
                <h3>‚úÖ My Current Signups</h3>
                <div id="mySignups">
                    <p>No current signups.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // WILLOW v40 GUARANTEED WORKING AUTHENTICATION FOR VOLUNTEERS
        const VOLUNTEER_GATE_CODE = '1957';
        let events = JSON.parse(localStorage.getItem('hhyc_events') || '[]');
        let tasks = JSON.parse(localStorage.getItem('hhyc_tasks') || '[]');
        let volunteers = JSON.parse(localStorage.getItem('hhyc_volunteers') || '[]');
        let isAuthenticated = false;
        let currentVolunteerName = '';

        function authenticateVolunteer() {
            const gateCode = document.getElementById('gateCode').value;
            const authError = document.getElementById('authError');

            if (gateCode === VOLUNTEER_GATE_CODE) {
                isAuthenticated = true;
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('volunteerInterface').style.display = 'block';

                // Get volunteer name
                currentVolunteerName = prompt("Welcome! Please enter your name for roster display:") || 'Anonymous Volunteer';

                loadEventTasks();
                loadMySignups();
                console.log('VOLUNTEER AUTHENTICATION SUCCESS: Gate code 1957 accepted');
            } else {
                authError.style.display = 'block';
                console.log('VOLUNTEER AUTHENTICATION FAILED: Wrong gate code entered');
            }
        }

        function loadEventTasks() {
            const eventTasksList = document.getElementById('eventTasksList');

            if (events.length === 0) {
                eventTasksList.innerHTML = '<p>No events available at this time.</p>';
                return;
            }

            let html = '';
            events.forEach(event => {
                const eventTasks = tasks.filter(task => task.eventId === event.id);

                if (eventTasks.length > 0) {
                    html += `
                        <div class="event-card">
                            ${event.image ? `<img src="${event.image}" alt="${event.name}" class="event-image">` : ''}
                            <h4>${event.name}</h4>
                            <p><strong>Date:</strong> ${new Date(event.date).toLocaleDateString()}</p>
                            <p><strong>Location:</strong> ${event.location}</p>
                            <p><strong>Description:</strong> ${event.description}</p>
                            <div style="clear: both;"></div>

                            <div style="margin-top: 1rem;">
                                <h5>Available Tasks:</h5>
                    `;

                    eventTasks.forEach(task => {
                        const isSignedUp = task.volunteers.some(v => v.name === currentVolunteerName);
                        const spotsLeft = task.volunteersNeeded - task.volunteers.length;
                        const workingWith = task.volunteers.length > 0 ? 
                            task.volunteers.map(v => v.name).join(', ') : 'Be the first to sign up!';

                        html += `
                            <div class="task-card">
                                <h6>${task.name}</h6>
                                <p>${task.description}</p>
                                <p><strong>Volunteers Needed:</strong> ${task.volunteersNeeded} | <strong>Spots Left:</strong> ${spotsLeft}</p>

                                <div class="working-with">
                                    <strong>Working with:</strong> ${workingWith}
                                </div>

                                ${isSignedUp ? 
                                    `<button class="btn btn-signed-up" disabled>‚úÖ Already Signed Up</button>` :
                                    spotsLeft > 0 ?
                                        `<button class="btn btn-signup" onclick="signUpForTask('${task.id}')">Sign Up for This Task</button>` :
                                        `<button class="btn" disabled>Task Full</button>`
                                }
                            </div>
                        `;
                    });

                    html += '</div></div>';
                }
            });

            if (html === '') {
                eventTasksList.innerHTML = '<p>No volunteer opportunities available at this time.</p>';
            } else {
                eventTasksList.innerHTML = html;
            }
        }

        function signUpForTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            // Check if already signed up
            if (task.volunteers.some(v => v.name === currentVolunteerName)) {
                alert('You are already signed up for this task!');
                return;
            }

            // Check if task is full
            if (task.volunteers.length >= task.volunteersNeeded) {
                alert('This task is already full!');
                return;
            }

            // Add volunteer to task
            task.volunteers.push({
                name: currentVolunteerName,
                signupTime: new Date().toISOString()
            });

            // Update local storage
            localStorage.setItem('hhyc_tasks', JSON.stringify(tasks));

            // Refresh displays
            loadEventTasks();
            loadMySignups();

            // Show success message
            const event = events.find(e => e.id === task.eventId);
            alert(`Successfully signed up for "${task.name}" at ${event ? event.name : 'Event'}!`);

            console.log(`SIGNUP SUCCESS: ${currentVolunteerName} signed up for task ${task.name}`);
        }

        function loadMySignups() {
            const mySignups = document.getElementById('mySignups');

            const myTasks = tasks.filter(task => 
                task.volunteers.some(v => v.name === currentVolunteerName)
            );

            if (myTasks.length === 0) {
                mySignups.innerHTML = '<p>No current signups.</p>';
                return;
            }

            let html = '';
            myTasks.forEach(task => {
                const event = events.find(e => e.id === task.eventId);
                const eventName = event ? event.name : 'Unknown Event';
                const eventDate = event ? new Date(event.date).toLocaleDateString() : 'Unknown Date';

                html += `
                    <div class="task-card">
                        <h6>${task.name}</h6>
                        <p><strong>Event:</strong> ${eventName}</p>
                        <p><strong>Date:</strong> ${eventDate}</p>
                        <p><strong>Description:</strong> ${task.description}</p>

                        <div class="working-with">
                            <strong>Working with:</strong> ${task.volunteers.map(v => v.name).join(', ')}
                        </div>
                    </div>
                `;
            });

            mySignups.innerHTML = html;
        }

        // Enter key support for gate code
        document.getElementById('gateCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                authenticateVolunteer();
            }
        });

        console.log('WILLOW v40 VOLUNTEER PORTAL LOADED - Gate code 1957 authentication ready');
    </script>
</body>
</html>